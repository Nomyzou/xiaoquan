(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/discussion-post/discussion-post"],{"1f87":function(t,e,n){"use strict";n.r(e);var o=n("a4ba"),i=n.n(o);for(var a in o)["default"].indexOf(a)<0&&function(t){n.d(e,t,(function(){return o[t]}))}(a);e["default"]=i.a},3936:function(t,e,n){"use strict";n.r(e);var o=n("afd5"),i=n("1f87");for(var a in i)["default"].indexOf(a)<0&&function(t){n.d(e,t,(function(){return i[t]}))}(a);n("ca4c");var u=n("828b"),r=Object(u["a"])(i["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],void 0);e["default"]=r.exports},"930c":function(t,e,n){},"994b":function(t,e,n){"use strict";(function(t,e){var o=n("47a9");n("f891"),n("861b");o(n("3240"));var i=o(n("3936"));t.__webpack_require_UNI_MP_PLUGIN__=n,e(i.default)}).call(this,n("3223")["default"],n("df3c")["createPage"])},a4ba:function(t,e,n){"use strict";(function(t){var o=n("47a9");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=o(n("7eb4")),a=o(n("7ca3")),u=o(n("af34")),r=o(n("ee10")),c=n("fa36");function s(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function l(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?s(Object(n),!0).forEach((function(e){(0,a.default)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var f={data:function(){return{dataValue:{situation:"inner",head:"",detail:"",type:"讨论",answer:[]},fileList1:[],picUrls:[],token:""}},onLoad:function(e){this.token=t.getStorageSync("token"),this.dataValue.ID_token=this.token,this.token?console.log("token",this.token):console.error("未找到 token"),this.id=e.id,this.title=decodeURIComponent(e.title),this.content=decodeURIComponent(e.content),this.isEdit="true"===e.isEdit,this.isEdit&&(this.dataValue.head=this.title,this.dataValue.detail=this.content),console.log("接收到的编辑参数：",{id:this.id,title:this.title,content:this.content,isEdit:this.isEdit})},methods:{onSubmit:function(e){var n=this;return(0,r.default)(i.default.mark((function o(){var a,s,l;return i.default.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return a=n,console.log(e),s=(0,u.default)(n.fileList1),s.forEach((function(t){t.status="uploading",t.message="正在上传"})),t.showToast({title:"上传中",icon:"fail"}),n.fileList1=s,o.next=8,Promise.all(s.map(function(){var t=(0,r.default)(i.default.mark((function t(e){var n,o;return i.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,n="uploads/".concat(Date.now(),"-").concat(Math.random(),".jpg"),t.next=4,c.uniCloud.uploadFile({cloudPath:n,filePath:e.url});case 4:if(o=t.sent,!o.success){t.next=9;break}return console.log("result",o),a.picUrls.push(o.fileID),t.abrupt("return",{url:o.fileID,status:"uploaded",message:"上传成功"});case 9:t.next=14;break;case 11:t.prev=11,t.t0=t["catch"](0),console.log("error",t.t0);case 14:case"end":return t.stop()}}),t,null,[[0,11]])})));return function(e){return t.apply(this,arguments)}}()));case 8:s=o.sent,console.log("updatelist",s),n.fileList1=s,l=a.dataValue,c.uniCloud.callFunction({name:"addDiscussion",data:{detail:l,picurls:a.picUrls,hType:"tz",token:a.token}}).then((function(e){console.log("res_前端",e),t.showToast({title:"提交成功",icon:"success"}),setTimeout((function(){t.reLaunch({url:"/pages/post-home/post-home"})}),1e3)}));case 13:case"end":return o.stop()}}),o)})))()},afterRead:function(t){var e=this;return(0,r.default)(i.default.mark((function n(){var o,a;return i.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:o=[].concat(t.file),a=e.fileList1,console.log("uplist,fileList",o,a),console.log("fileList before:",a),o.map((function(t){a.push(l(l({},t),{},{status:"uploaded",message:"ok"}))})),console.log(a);case 6:case"end":return n.stop()}}),n)})))()},deletePic:function(t){this.fileList1.splice(t.index,1)},exit:function(){t.switchTab({url:"/pages/post-home/post-home"})}}};e.default=f}).call(this,n("df3c")["default"])},afd5:function(t,e,n){"use strict";n.d(e,"b",(function(){return i})),n.d(e,"c",(function(){return a})),n.d(e,"a",(function(){return o}));var o={uIcon:function(){return Promise.all([n.e("common/vendor"),n.e("uview-ui/components/u-icon/u-icon")]).then(n.bind(null,"899d"))},uButton:function(){return Promise.all([n.e("common/vendor"),n.e("uview-ui/components/u-button/u-button")]).then(n.bind(null,"6181"))},uTextarea:function(){return Promise.all([n.e("common/vendor"),n.e("uview-ui/components/u-textarea/u-textarea")]).then(n.bind(null,"1b45"))},uUpload:function(){return Promise.all([n.e("common/vendor"),n.e("uview-ui/components/u-upload/u-upload")]).then(n.bind(null,"92c5"))}},i=function(){var t=this.$createElement;this._self._c},a=[]},ca4c:function(t,e,n){"use strict";var o=n("930c"),i=n.n(o);i.a}},[["994b","common/runtime","common/vendor"]]]);